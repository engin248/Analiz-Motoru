name: Backend Deploy

on:
  push:
    branches:
      - main  # EÄŸer dal isminiz 'master' ise burayÄ± deÄŸiÅŸtirin
    # EÄŸer backend ve frontend aynÄ± repodaysa, sadece backend deÄŸiÅŸince Ã§alÄ±ÅŸsÄ±n diye:
    # paths:
    #   - 'LangChain_backend/**'

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: 22
          script: |
            # Hata olursa iÅŸlemi durdur
            set -e
            
            echo "ğŸ”Œ Sunucuya baÄŸlanÄ±lÄ±yor..."
            
            # 1. Backend klasÃ¶rÃ¼ne git
            cd /var/www/backend/LangChain_backend
            
            # 2. GÃ¼ncel kodlarÄ± Ã§ek
            echo "ğŸ“¥ Kodlar Ã§ekiliyor..."
            git pull origin main
            
            # 3. Python Sanal OrtamÄ±nÄ± GÃ¼ncelle
            echo "ğŸ KÃ¼tÃ¼phaneler yÃ¼kleniyor..."
            source venv/bin/activate
            pip install -r requirements.txt
            
            # 4. Sistemi Yeniden BaÅŸlat
            echo "ğŸš€ PM2 servisi yeniden baÅŸlatÄ±lÄ±yor..."
            pm2 restart lumora-backend
            
            echo "âœ… Backend baÅŸarÄ±yla gÃ¼ncellendi!"
